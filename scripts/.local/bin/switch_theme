#!/usr/bin/env bash

supported_themes="gruvbox-material tokyonight-storm"

theme=${1:-gruvbox-material}

supported=0
for sup_theme in $supported_themes
do
  if [[ "${sup_theme}" = "${theme}" ]]
  then
    supported=1
  fi
 done

if [ $supported -ne 1 ]
then
  echo "$(basename $BASH_SOURCE): unsupported theme ${theme}" >&2
  exit 1
fi

# Switch theme of iterm2
colorseq="\e]1337;SetColors=preset=$theme\a"

# Now switch theme at all relevant places depending if we are in a tmux session
# or not.
if [ -z $TMUX ]
then
  # No tmux session running
  printf "$colorseq"
else
  # We are in a tmux session
  printf "\ePtmux;\e$colorseq\e\\"

  # Change tmux theme
  tmux_theme="${XDG_CONFIG_HOME:-$HOME/.config}"/tmux/$theme.tmux
  if [ ! -r $tmux_theme ]
  then
    echo "$(basename $BASH_SOURCE): tmux theme file not found: ${tmux_theme}"
    exit 1
  fi

  tmux source-file $tmux_theme
fi

exit 0
